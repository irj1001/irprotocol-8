<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</variable><variable id="q^S4EwB6_S.}|4RX$R8W">IRReceiveState</variable><variable id="mkt,?D_Qw2`v4[PrZZry">IRRCV_DETECT_BIT</variable><variable id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</variable><variable id="%!z}6!(SJNAI.ApRvr)6">START_STOP_PAUSE</variable><variable id="DisgAaspL/R22wTaoMWy">space</variable><variable id="t/A{k1;7HUij^Y5A{Pj_">mark</variable><variable id="ragNj:mU(*KoOYC4Zs~!">index</variable><variable id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</variable><variable id="D9iUAgqlCUq:^5(])2L?">receivedBits</variable><variable id="_$@f0jr;3yivGg;4#n%/">SHOT_MESSAGE_BIT_SIZE</variable><variable id="zo;.;0unU95(MqE{IB}v">lasIRShotReceived</variable><variable id="fn}|G=gs7rY([Ptj6BiD">LOW_PAUSE</variable><variable id="w#j2H4v}5:PPlsgOmcSz">IRRCV_DETECT_START_STOP</variable><variable id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</variable><variable id="sv(*sMC.Y6!LP7QQ(|2D">SHOT_MESSAGE</variable><variable id="TGm-pH3B8pyH+*9]kK{8">PLAYER_ID_BIT_SIZE</variable><variable id="VIe~3y9PIphdK)v)-g!;">HIGH_PAUSE</variable><variable id="ShaO^DvxrLef5^iO(X90">messageBeingSent</variable><variable id="2Pt#HhkXH5`/l(p#$jdP">mask</variable><variable id="xIc6)R2z)LeZrb{C5O#G">temp1</variable></variables><comment id="Ir=#b,CmVXSSKTsJfiD?" minimized="true" data="0" x="265" y="3308" h="360" w="480">Explicação do código

Tanta modelação para aqui e para acolá para dizer que o que conta é o tempo que dura cada símbolo no meio. Por símbolo entende-se um pedaço de 6 períodos a 1 e uma tamanho variável a 0. Para encontrarmos o início do frame é preciso um símbolo especial. Para ser despoletada uma transição depois do último bit que funcione como trigger para receber o seu fim usa-se o mesmo quadro que por isso é denominado START/STOP. Na verdade eu usei dois no início e dois no fim. Reparei que funciona melhor. Inspitei-me em código de extensões mas depois percebi porque é que não há nada na net: os timings são tramados de controlar. Por esse motivo há uma função de calibração inicial mas que no meu caso dá maus resultados e por isso usei tempos que medi caso a caso. Podem precisar de ajustes em função de como cresça o peso de processamento do código.

Seguem-se algumas explicações das fontes de inspiração a que recorri para o emissor IR. Masi abaixo aparecerá para o recetor IR.

Emissor IR =============================================================

https://github.com/philipphenkel/pxt-powerfunctions/blob/master/powerfunctions.ts.

Recriei aqui a lógica do ficheiro "powerfunctions" da extensão acima realiza para enviar mensagens de 16 bits.

Ele tb usou o TSAL6100.

Se no meu slide procurar o "Modulated IR Signal" está lá um diagrama de como são codificados todos os bits!

Na verdade só não aparece muito explícito o número de períodos PWM mas pelo código é fácil deduzir.

O código começa por calcular quanto tempo a microbit leva em média para fazer algumas operações (calibração) de modo a que os timings sejam rigorosos.

As mensagens são um inteiro de 16 bits. no pior caso estes 16 bits demoram 522 períodos PWM (de 26 microsegundos cada), ou seja 13,572 milisegundos.

Eles usam um truque engraçado: repetem 5 vezes o envio, no terceiro envio esperam alguns ms a mais e no último ainda mais e em função do que chamam canal!!!

O Head inicial e final são constituídos por um marcador (ou seja um "1" modulado) e um espaço em branco iniciais e devem demorar 45 períodos ao todo: 6 o marcador e 39 em branco.

Um "1" é constituído por 27 períodos ao todo: 6 o marcador e 21 em branco.

Um "0" é constituído por 16 períodos ao todo: 6 o marcador e 10 branco.

Conseguimos distinguir os valores binário em transmissão pelo simples facto de termos (bit 0) ou não flutuações nos período que medeiam entre o 16 e o 22 depois de se dar início

=========================================================================

Adaptação ao meu jogo laser quest:

Não me pareceu em nada necessário incluir redundância. Talvez jogando de dia dê jeito. Por isso avanço já com o seguinte esquema:

Nas experiências comecei por usar IR_MARK=100, START_STOP_PAUSE=820, LOW_PAUSE=100 e HIGH_PAUSE=500.

funcionava para 2 bits mas não para 6 bits. Havia muitos erros de transmissão.

Naumentei para IR_MARK=200, START_STOP_PAUSE=1500, LOW_PAUSE=200 e HIGH_PAUSE=1000.

Adaptação ao meu jogo laser quest:

Não me pareceu em nada necessário incluir redundância. Talvez jogando de dia se mostre útil. Por isso avanço já com o seguinte esquema:

Nas experiências comecei por usar IR_MARK=100, START_STOP_PAUSE=820, LOW_PAUSE=100 e HIGH_PAUSE=500.

funcionava para 2 bits mas não para 6 bits. Havia muitos erros de transmissão.

Aumentei para IR_MARK=200, START_STOP_PAUSE=1500, LOW_PAUSE=200 e HIGH_PAUSE=1000 e funcionou perfeitamente com 6 bits.

Novo tempo máximo de quadro = (200*(4+18)) + 4*1500 + 18*1000 = 28,4 ms  (ainda assim muito baixo)

Não podemos esquecer que acresce a isto redundância. Aumentei para 4 o número de quadros SS a abrir e fechar a frame para ser ainda mais robusto pois estes quadros não possuem redundância binária.

O quadro terá 18 bits úteis. Juntando os 2 SS iniciais e 2 SS finais fico com um quadro que pode ter 360 a 666 períodos de 26 microsegundos, ou seja 9,360 ms a 18,648 ms.

Este tempo assumindo ainda que é vibrado por uma onda quadrada com um duty cycle de 50% é super seguro em termos de saúde ocular. Muitíssimo menos potência.

Adicionalmente permite-nos operar o LED com corrente alta sem perigo de aquecimento.

O esquema de redundância passa por enviar enviar três vezes seguidas e repetidas os mesmos 6 bits úteis base.

Este terão a seguinte interpretação: (msb) e1 e0 j3 j2 j1 j0 (lsb)

- ei são bits que representam uma de quatro equipas

- ji são bits que representam um de 16 jogadores da referida equipa

No total suportamos 64 players simultâneos.

O envio de três vezes seguidas facilita a lógica de envio e de receção.

Na receção faço votação dos bits recebidos. É preciso haver dois bits errados separados por seis bits para não detetar o erro, logo a comunicação é robusta.

Teremos de criar um modo inicial de programação (A+B) de cada pistola e capacete em que indicamos em cada Microbit, a função de operação desejada (pistola/capacete), a equipa (numa rotação de 4 valores) e depois o id do jogador numa rotação de 16 valores. Esse valor deve ser gravado na flash da microbit. O registo dos IDs deve ser feito inicialmente.

Ao receber o tiro o capacete ilumina-se com a cor da equipa alvejada por 2 segundos, depois em modo flash a cor da equipa que alvejou e novamente a continuo a cor da equipa alvejada. Desta forma por comunicação visual os jogadores percebem quem morreu e quem matou. Por rádio envia-se essa informação também, podendo a mesma ser consultada .

Posso ainda dar a possibilidade de programar dois modos de disparo: manual e automático: no primeiro envia-se uma bala. No segundo disparam-se 10 balas separadas por 100 ms.</comment><block type="pxt-on-start" id="Udf,L,;+:DMRXo3]33Ab" x="0" y="0"><statement name="HANDLER"><block type="variables_set" id="RQgnO;?$yLWu5X$o6N],"><field name="VAR" id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</field><comment pinned="false" h="80" w="160">Valor de 6 bits conforme explicação externa. Mais tarde esta valor deverá ser programável manualmente e armazenável de forma não volátil. Este valor vais ser colocado nas balas para identificar quem mata quem.</comment><value name="VALUE"><shadow type="math_number" id="G`;W$0rj{@.JH7azTZWe"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="52xgW/v2w3Q0*}QDNzM7"><field name="VAR" id="TGm-pH3B8pyH+*9]kK{8">PLAYER_ID_BIT_SIZE</field><value name="VALUE"><shadow type="math_number" id="vm8jfTQqev`^~B%9kMxL"><field name="NUM">6</field></shadow></value><next><block type="variables_set" id=";%3hsieMSWn1!_SLhrbw"><field name="VAR" id="_$@f0jr;3yivGg;4#n%/">SHOT_MESSAGE_BIT_SIZE</field><comment pinned="false" h="80" w="160">Vamos repetir a mensagem três vezes seguidas para robustez</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="-@g-Y:h5aS|I[|)c(vAq"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="O?Daw~xR2sacTOZc5)O+"><field name="NUM">3</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="^#|dSHn)39#:NJZt(~Ok"><field name="VAR" id="TGm-pH3B8pyH+*9]kK{8">PLAYER_ID_BIT_SIZE</field></block></value></block></value><next><block type="variables_set" id="WFLR|J:1qWv%w})P_.59"><field name="VAR" id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</field><comment pinned="false" h="80" w="160">-opetei por especificar valores diretamente depois de testar offline</comment><value name="VALUE"><shadow type="math_number" id="*eO}Anx6`/`O$V:WgL.x"><field name="NUM">200</field></shadow></value><next><block type="variables_set" id="ItleP8lXQyE]R].C8p0_"><field name="VAR" id="%!z}6!(SJNAI.ApRvr)6">START_STOP_PAUSE</field><value name="VALUE"><shadow type="math_number" id="OsxO*RL.mMIA.]7x*~o%"><field name="NUM">1500</field></shadow></value><next><block type="variables_set" id="#e~(Cg^yf3:o%5$H2gt^"><field name="VAR" id="fn}|G=gs7rY([Ptj6BiD">LOW_PAUSE</field><value name="VALUE"><shadow type="math_number" id="eO|7:cx1m2V8sqFBc|i@"><field name="NUM">200</field></shadow></value><next><block type="variables_set" id="A$AQGeWA|~zk?23mhn`3"><field name="VAR" id="VIe~3y9PIphdK)v)-g!;">HIGH_PAUSE</field><comment pinned="false" h="80" w="160">Math.idiv((27 - 6) * 1000000, 38000) = 552</comment><value name="VALUE"><shadow type="math_number" id="LsPeH?9/m~eWP(IM#R6~"><field name="NUM">1000</field></shadow></value><next><block type="function_call" id="Ds@qK^10b*l+mg_.GOV["><mutation name="enableIRTransmission" functionid="(}qtMe~^t?R/5l~n|7)4"></mutation><next><block type="function_call" id="cRNTLg$z`2Q:9FB6`[-1"><mutation name="enableIRDetection" functionid="Dx,b{x^ww+l2^7~e5l[C"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="control_on_event" id="a=t*V{5n7*z1;w8D?/Y=" x="710" y="0"><value name="src"><shadow type="control_event_source_id" id="JTFabgIH#)C$H)vd.Y[;"><field name="id">EventBusSource.MICROBIT_ID_IO_P19</field></shadow></value><value name="value"><shadow type="control_event_value_id" id="{r)7`jxiK:P6W95mZVxo"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="DS@-yU0e]JrgIAe2zopZ"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="emt]_t#CXoC2%#xK|4lF"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="control_event_value&quot;" id="Ny?u,/D*QPxLF3+.A*!2"></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="1./|z![CN$I;`YzM3)Ff"><field name="VAR" id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</field></block></value></block></value><next><block type="controls_if" id="Ar]z=L;m}lif$9V*J7[W"><mutation else="1"></mutation><comment pinned="false" h="80" w="160">Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.
Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="DkKS/f[hjb*LW|!,zdmy"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="u%(v!(z|n%R~;w9Xn~=p"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="PtaV}PoVC?J8xf/jLuLe"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="2u,L)N6OhhWC66bmev}I"><field name="NUM">1300</field></shadow></value></block></value><value name="B"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="PyI/+J~f3m+hcn=I,h0a"><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id=")o~aE~%qoiCke7*d?KJ)"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id=")]$Et1okZS[U?a?zMFMG"><field name="NUM">1700</field></shadow></value></block></value></block></value><statement name="DO0"><block type="function_call" id="8p|Wc#zU5@.,#9K1;H6W"><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation><next><block type="variables_set" id="#.Xg3QpU?r~Fcbpla7dC"><field name="VAR" id="q^S4EwB6_S.}|4RX$R8W">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="cIcXLWVKBeZ~JT}n1^y?"><field name="VAR" id="mkt,?D_Qw2`v4[PrZZry">IRRCV_DETECT_BIT</field></block></value></block></next></block></statement><statement name="ELSE"><block type="controls_if" id="s:HRA1bgvk6JaC}pW[pV"><mutation elseif="1" else="1"></mutation><comment pinned="false" h="80" w="160">Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.
Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima
Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.
Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="L/!YW+%CH381S`^D5s8{"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="jl+?=A(Du*43OcYq+sr6"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9wKR#$CK(c$L-iD;4rAu"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="K8;v*zy:J+wsazH;|~qz"><field name="NUM">800</field></shadow></value></block></value><value name="B"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="C/`YlSvUV-L#-3xm3BAy"><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="%O:S@!UP=nNh}JO.hQ!A"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="BMqGd}W!!9edwwI[1;yZ"><field name="NUM">1200</field></shadow></value></block></value></block></value><statement name="DO0"><block type="function_call" id="#I1JboHBZ!Qm~Vur+b~u"><mutation name="pushBitOne" functionid="44{ORh(LabMll`vJ#{GU"></mutation></block></statement><value name="IF1"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="$jfoQH9l#Hl0B2R^c~T7"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="AwN~a);`P0;`7[Zk?A_0"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="lD_#Nlb5;_k(Z+,.P?+7"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="(8.:O7ao{au_yQ.TSfuV"><field name="NUM">50</field></shadow></value></block></value><value name="B"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="#r5![IYRp*bvoFyXa?bU"><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="t/SJ[nz-Botd2B%)%X_a"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="Rj=e{:U$8IX+9R_$W,Ui"><field name="NUM">400</field></shadow></value></block></value></block></value><statement name="DO1"><block type="function_call" id="AP)9q+gMV+;~Y?z^Bfqk"><mutation name="pushBitZero" functionid="K+Ubqj%jEIe(I,_V.x);"></mutation></block></statement><statement name="ELSE"><block type="device_show_number" id="DGl)]y:#@5|;S^AVo?ty"><value name="number"><block type="variables_get" id="h5h8=[GpXL{C4h?g!q9R"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><next><block type="function_call" id="mmfQS(b5k4MQE4t{2a7("><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation></block></next></block></statement></block></statement></block></next></block></statement></block><block type="control_on_event" id="N(^nCpqpo|w;3NVJ(qF}" x="1647" y="0"><value name="src"><shadow type="control_event_source_id" id="6j3?$v]fAr,H)XgA6#?."><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id" id="eaw-K;,m|VT.@Ey!W4b!"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow></value><statement name="HANDLER"><block type="device_print_message" id="=I`mxT6:-DorPl@)WObM"><value name="text"><shadow type="text" id="m-te?3.w:X@HJ`u8#779"><field name="TEXT">R=</field></shadow></value><next><block type="device_show_number" id="4W6}fd|-X9tX{p0|48I$"><value name="number"><block type="variables_get" id="vZKfhw,tFuZ(Qa`mI0x{"><field name="VAR" id="zo;.;0unU95(MqE{IB}v">lasIRShotReceived</field></block></value><next><block type="device_pause" id="*,I(m8f@!o^{6?tWB[Y?"><value name="pause"><shadow type="timePicker" id="6n7LO:5/``Py.102=N5f"><field name="ms">1000</field></shadow></value><next><block type="device_clear_display" id="x_!T@+-J{yLG?t09ahDd"></block></next></block></next></block></next></block></statement></block><block type="device_button_event" id="WGUP(2SLA@kC4;fi^}:l" x="2321" y="0"><field name="NAME">Button.A</field><comment pinned="false" h="80" w="160">USER INTERFACE:

A+B four consecutive times (with 1 second) =&gt; Enter into configuration mode



Then the display will explain the configuration:

A: Swap between single shot and burst shot

B: Me-&gt; :How many players I shot / ME&lt;- :How many times I was shot / Best Team

A+B: How many shots I already use</comment><statement name="HANDLER"><block type="variables_change" id=":i}|N]CQdbVO#tr~xv,^"><field name="VAR" id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</field><value name="VALUE"><shadow type="math_number" id="dVX5D=`A9ny!9G6KT02s"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="D|^s8()mQyku[Be%tn0s"><field name="VAR" id="sv(*sMC.Y6!LP7QQ(|2D">SHOT_MESSAGE</field><comment pinned="false" h="80" w="160">Three consecutive replicas of PLAYER_ID for redundancy.</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="LPe9aU(Ow2c@3}Pa0V/Z"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="XW9yh`|;tEPtvx8KOrtx"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="$@2;*8r_gYu+[2zM/U{*"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="W*W*dJebw]m[|$pmjnse"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="e894opryal9?,4}{ZX;K"><field name="VAR" id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="(hJKaX)25++k^7f(.ldU"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="~k||W68Yrw48S/iT`@0#"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="|#6+I0?R/E8DOz3PT6FE"><field name="VAR" id="TGm-pH3B8pyH+*9]kK{8">PLAYER_ID_BIT_SIZE</field></block></value></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="4r*BMZ!StRFWGDOry9NZ"><field name="VAR" id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</field></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="FR;pR!1GHKEuWu6KQQ7~"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="{VSq?$2i;tZFq[8Hwb:0"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="@UyS!~q},-D[#*:MJXLk"><field name="VAR" id="TGm-pH3B8pyH+*9]kK{8">PLAYER_ID_BIT_SIZE</field></block></value></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="DFX)8WRCYc_xZx-e5YH."><field name="VAR" id="qcXwPREbFSyOU9MP=Ch0">PLAYER_ID</field></block></value></block></value><next><block type="device_show_number" id=";K=Qs_G@9D{Z`]cNgi,E"><value name="number"><block type="variables_get" id=";-cE?I/XF{fgLf+6(w[6"><field name="VAR" id="sv(*sMC.Y6!LP7QQ(|2D">SHOT_MESSAGE</field></block></value><next><block type="function_call" id="zA#i)lbZCaiF:=$h_0:/"><mutation name="IRShot" functionid="BTKb=04g;|=[[dbQ=09o"></mutation><next><block type="device_clear_display" id="Q2G;BZ!PL)eoSFv_emV%"></block></next></block></next></block></next></block></next></block></statement></block><block type="pins_on_pulsed" id=",*=?9@om[M$?cA0XsokS" x="0" y="1678"><field name="pin">DigitalPin.P2</field><field name="pulse">PulseValue.Low</field><comment pinned="false" h="80" w="160">// HIGH</comment><statement name="HANDLER"><block type="variables_set" id="RmD|7p#7;M$C0G)!N^Fo"><field name="VAR" id="t/A{k1;7HUij^Y5A{Pj_">mark</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="pins_pulse_duration" id="DLUM6*E0$c4DtR]0K2VN"></block></value></block></statement></block><block type="pins_on_pulsed" id="h7g:o}tzhQ;ibY`oyMB=" x="413" y="1678"><field name="pin">DigitalPin.P2</field><field name="pulse">PulseValue.High</field><comment pinned="false" h="80" w="160">// LOW</comment><statement name="HANDLER"><block type="variables_set" id="_INx=DNyBKlDU^K6)9Xq"><field name="VAR" id="DisgAaspL/R22wTaoMWy">space</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="pins_pulse_duration" id="r+MRdeuM~)fj]52}m72-"></block></value><next><block type="control_raise_event" id="-A=^4;Q;]`a2tTuZw|W("><value name="src"><shadow type="control_event_source_id" id="+;ZNN5.Z9~5H}d,Y[#)l"><field name="id">EventBusSource.MICROBIT_ID_IO_P19</field></shadow></value><value name="value"><shadow type="control_event_value_id"></shadow><block type="math_arithmetic" id="m#4cTBGA(8s?jM.o$-_r"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="?G#3:M%f/)UH/1~bKZpg"><field name="VAR" id="t/A{k1;7HUij^Y5A{Pj_">mark</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="wx%C%`S6_~Q{;s!Q19Gf"><field name="VAR" id="DisgAaspL/R22wTaoMWy">space</field></block></value></block></value></block></next></block></statement></block><block type="function_definition" id="XughoB#K/Y!ugH}jTuta" x="835" y="1678"><mutation name="detectStartStop" functionid="Zfzf}TB96U~VJI33_EA|"></mutation><field name="function_name">detectStartStop</field><comment pinned="false" h="80" w="160">Fonte de inspiração:

Recetor IR =============================================================

Extensão: https://github.com/1010Technologies/pxt-makerbit-ir-receiver/blob/master/infrared.ts

Na pasta Projet é o zip pxt-makerbit-ir-receiver-master.zip e o ficheiro infrared.ts

Usei como inspiração para desenhar o meu recetor que case com o de cima.

Como este terá uma thread em background será bom no final eu ter um projeto para o emissor e outro para o recetor.

Pelas minhas contas e assumindo que o pulseToPulse=tempo de mark + tempo de space

Sequência START_STOP demorará 45 períodos de 26 microsegundos ou seja pulseToPulse = 1014 microsegundos (IRMARK + START_STOP_PAUSE)

Sequência LOW demorará 16 períodos de 26 microsegundos ou seja pulseToPulse = 416 microsegundos (IRMARK + LOW_PAUSE)

Sequência HIGH demorará 27 períodso de 26 microsegundos ou seja pulseToPulse = 702 microsegundos  (IRMARK + HIGH_PAUSE)





Todos os valores foram afinados por mim de forma manual.</comment><statement name="STACK"><block type="controls_if" id="r2OAZE*Ou(+SAIkkEW;s"><comment pinned="false" h="80" w="160">Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="l53K$]%BZ0m^kUw[K90g"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="8dNx:i$8ZrFFNY`~:e3P"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="bzFjE9su`gtz8^TWY*H-"><field name="NUM">900</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id=".]bx|`XeG@nzwnYxi_+k"><field name="VAR" id="q^S4EwB6_S.}|4RX$R8W">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="*gF]Sj^Hr7)@waK5k4oi"><field name="VAR" id="mkt,?D_Qw2`v4[PrZZry">IRRCV_DETECT_BIT</field></block></value></block></statement></block></statement></block><block type="function_definition" id="o;Kt@!ya59D,w.Wd!P/z" x="1345" y="1678"><mutation name="transmitBitStartStop" functionid="6|wwB@+-N!Kf4vedT8sL"></mutation><field name="function_name">transmitBitStartStop</field><comment pinned="false" h="80" w="160">A calibração parece não estar a resultar. Medi e afinei com valores fixos. O bloco ao lado é o código original (deixo para referência).</comment><statement name="STACK"><block type="controls_repeat_ext" id="%d)i)1$9mcBu=hF]U*bj"><value name="TIMES"><shadow type="math_whole_number" id="PI7A$g2SP6vi8d+*|4q,"><field name="NUM">2</field></shadow></value><statement name="DO"><block type="device_set_analog_pin" id="_8b3VZ;?gRgaXj8{eIp$"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="f[~H8r}Ugec.weO$m?Y%"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="=@@90C59mYv,Nxc?K/w6"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="c*5Rg3P;Vm5^itSVj]$2"><field name="VAR" id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="Uc,d}3BAoj.`h+3S#0,!"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="SSAOHy?`bbJ}j;a8|fEz"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="oTKj.%WX%?-JH*VeV`uz"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="FD9[L6nm!p|ZM2zeLm-8"><field name="VAR" id="%!z}6!(SJNAI.ApRvr)6">START_STOP_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block></statement></block><block type="function_definition" id="[sb2/EWa-aJ@=`UH5l2P" x="1741" y="1678"><mutation name="enableIRTransmission" functionid="(}qtMe~^t?R/5l~n|7)4"></mutation><field name="function_name">enableIRTransmission</field><comment pinned="false" h="80" w="160">Fazia o trabalho do construtor de class InfraredDevice. Adaptei apenas para inicializar a porta analógica PWM.</comment><statement name="STACK"><block type="device_set_analog_pin" id="{bl9OFL|./3:5;rODb{["><field name="name">AnalogPin.P0</field><comment pinned="false" h="80" w="160">We will use PWM, with a frequency of 38 KHz</comment><value name="value"><shadow type="math_number_minmax" id="v]VaVm/cyO%b1B$jP)#b"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">0</field></shadow></value><next><block type="device_set_analog_period" id="GT-2*f?PR53|shs]jb9B"><field name="pin">AnalogPin.P0</field><value name="micros"><shadow type="math_number" id="}pA}7f]{]rfGZU^{(}!c"><field name="NUM">26</field></shadow></value><next><block type="pxt_controls_for" id="{^$o)o00l+QBxy//AG:a"><value name="VAR"><shadow type="variables_get_reporter" id="YlnvLGLHF=HE+|(l$I8y"><field name="VAR" id="ragNj:mU(*KoOYC4Zs~!">index</field></shadow></value><value name="TO"><shadow type="math_whole_number" id="j)4@xgKsg{5%0Y:1pd7s"><field name="NUM">7</field></shadow></value><statement name="DO"><block type="device_set_analog_pin" id="HXBQox[Kq[0H^]EvbHks"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id=".fzNgbq?c1}uN84!Sp!,"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="Y39oiL}qNHnlOR~jji.R"><value name="micros"><shadow type="math_number_minmax" id="Nx{9AT~_Ra65+jnGoLLB"><mutation min="0" max="6000" label="Number" precision="0"></mutation><field name="SLIDER">1</field></shadow></value></block></next></block></statement><next><block type="device_set_analog_pin" id="aPp;EupetBTSFWL0:d;#"><field name="name">AnalogPin.P0</field><comment pinned="false" h="80" w="160">We will use PWM, with a frequency of 38 KHz</comment><value name="value"><shadow type="math_number_minmax" id="0kFo7VNWjNpZ,W87u^s^"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">0</field></shadow></value></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="Y`k4S+tcMQvi;Zx21~)O" x="2182" y="1678"><mutation name="pushBitZero" functionid="K+Ubqj%jEIe(I,_V.x);"></mutation><field name="function_name">pushBitZero</field><statement name="STACK"><block type="variables_set" id="H}w4sEI``U]`^(9W^zhl"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field><comment pinned="false" h="80" w="160">Shift left de 1 bit</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="9yhBbg$({3`Kwhgo](tb"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="=XRw7H]j!We;sE}a2F3l"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field></block></value><value name="B"><shadow type="math_number" id="HM3Z6Zxf0c~yvPE!B!pn"><field name="NUM">2</field></shadow></value></block></value><next><block type="variables_change" id="*%kIbB{!g7;ezi:Y:c{X"><field name="VAR" id="D9iUAgqlCUq:^5(])2L?">receivedBits</field><value name="VALUE"><shadow type="math_number" id="RY)(N_0)k,cm_*rDv}y^"><field name="NUM">1</field></shadow></value><next><block type="controls_if" id="/))ub?HUpTU~!4CDny_;"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=")E4Eb:?a4Pb^T%E7;g~%"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Jb.[xC[T-K8bYlB`UQM)"><field name="VAR" id="D9iUAgqlCUq:^5(])2L?">receivedBits</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="AftGi)}rB$KqU/c-(`Xf"><field name="VAR" id="_$@f0jr;3yivGg;4#n%/">SHOT_MESSAGE_BIT_SIZE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="S%KmBvZEp6vPl[P5gpN1"><field name="VAR" id="zo;.;0unU95(MqE{IB}v">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="V)zEC[~U-[4^fG9vqs1."><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field></block></value><next><block type="control_raise_event" id="0ymvY,P`Uz*]|ugHdu7S"><value name="src"><shadow type="control_event_source_id" id="!i6J)hfvrU}Kn;%^J9@Y"><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id"></shadow><block type="math_number" id="8[k$I{:PYfHk/Cl*0y,;"><field name="NUM">0</field></block></value><next><block type="function_call" id="VsT{fBH8Qm^R5k4F*^3f"><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation></block></next></block></next></block></statement></block></next></block></next></block></statement></block><block type="function_definition" id="4X{dS1Ep^rSm``7`R6vf" x="2900" y="1678"><mutation name="transmitBitLow" functionid="NOtt@3Uy@)B%v/F~[85_"></mutation><field name="function_name">transmitBitLow</field><statement name="STACK"><block type="device_set_analog_pin" id="`kR`,P{JhdzoXw!RNEu0"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="eon@%`oki[,n*G#!hQCi"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="nSR[GJuv|wyE5m%C4{Gx"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="6*nfK@z-%-idz5FO*s|h"><field name="VAR" id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="(6^(QUy{fyT}O!,q}c-b"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="cd[]I/~AK9Ktx7?=,|g?"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="S5{QM.[!%K_7/GB+c/*y"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="[g@D;^Gs1HO?B(ei!S`v"><field name="VAR" id="fn}|G=gs7rY([Ptj6BiD">LOW_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="~#OGAs3w[P]nqlE!C#Kd" x="3261" y="1678"><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation><field name="function_name">Reset</field><statement name="STACK"><block type="variables_set" id="s}t8NExPK[lcQ%nu$|?r"><field name="VAR" id="w#j2H4v}5:PPlsgOmcSz">IRRCV_DETECT_START_STOP</field><value name="VALUE"><shadow type="math_number" id="?@Yvlc:yw2Q7wRn6U9ul"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="+JzU_b4q50*`|=IBdZbe"><field name="VAR" id="mkt,?D_Qw2`v4[PrZZry">IRRCV_DETECT_BIT</field><value name="VALUE"><shadow type="math_number" id="J+bi(Nt^jS@psVSna+.#"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="+e`e.fv|(]Re=jS3}H]O"><field name="VAR" id="q^S4EwB6_S.}|4RX$R8W">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="},Q,SSuqSY~k/j+^Hzt!"><field name="VAR" id="w#j2H4v}5:PPlsgOmcSz">IRRCV_DETECT_START_STOP</field></block></value><next><block type="variables_set" id="=8dtQOt53MMCaseuYy-B"><field name="VAR" id="D9iUAgqlCUq:^5(])2L?">receivedBits</field><value name="VALUE"><shadow type="math_number" id="WLv@?o{Y@)/rqhhc=zfP"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="e4wVJKwWmKsQ/U/*%!uc"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field><value name="VALUE"><shadow type="math_number" id="u3mQCrWY5t$}NA{Qgtn{"><field name="NUM">0</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="RmE^9SHiE|C80-IDs5[w" x="3817" y="1678"><mutation name="pushBitOne" functionid="44{ORh(LabMll`vJ#{GU"></mutation><field name="function_name">pushBitOne</field><statement name="STACK"><block type="variables_set" id="{|6@f]Q%X,Pl*(Df|MMW"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field><comment pinned="false" h="80" w="160">Shift left de 1 bit</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="W}[TlFeyaN|?eHVEo~gc"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="%xXVs2Amk{pG$iWamA3C"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field></block></value><value name="B"><shadow type="math_number" id="n2KSH:;V2FvC!miou6H?"><field name="NUM">2</field></shadow></value></block></value><next><block type="variables_change" id="MPs1E@N9kPV{!dQP7CUc"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field><value name="VALUE"><shadow type="math_number" id="]:`,nWxNM0oXyjf`z?.6"><field name="NUM">1</field></shadow></value><next><block type="variables_change" id="6K+n*628I#oEHS!{gRWV"><field name="VAR" id="D9iUAgqlCUq:^5(])2L?">receivedBits</field><value name="VALUE"><shadow type="math_number" id="hO0DIHfP#tLV$U#JXx^n"><field name="NUM">1</field></shadow></value><next><block type="controls_if" id="2Yc4nj,XW+:tvn)f.d6v"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="t~V0-Tj2C-(#scML1;rG"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="u8ND,zfrfV=d-6EI7vLv"><field name="VAR" id="D9iUAgqlCUq:^5(])2L?">receivedBits</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="IZq6I7(GlFKh(PT4q@V`"><field name="VAR" id="_$@f0jr;3yivGg;4#n%/">SHOT_MESSAGE_BIT_SIZE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="r|:bL:R$C`JGuws]uj#3"><field name="VAR" id="zo;.;0unU95(MqE{IB}v">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="xCB9qB}k?n_)Ja*TW%J?"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field></block></value><next><block type="control_raise_event" id="a##V#qk@#SFOb03be4dx"><value name="src"><shadow type="control_event_source_id" id="s6sGGPrq4Eh~AXv!=-^1"><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id"></shadow><block type="math_number" id="u*(uph*[i#Aq?QiArE.`"><field name="NUM">1</field></block></value><next><block type="function_call" id="d[_E!}#I)qp.G)wx)b40"><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="T@Be6;#yG?w+e=/FDQ9@" x="0" y="2297"><mutation name="transmitBitHigh" functionid="+D.,.lrT@1,${Y@8bRw,"></mutation><field name="function_name">transmitBitHigh</field><statement name="STACK"><block type="device_set_analog_pin" id="~gYX{_Pg[K]PY:{eZ0C]"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="m)|cvV=GS-cM;?2[aH$x"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="V:Ya,P=Y7aN5fPi;ZT+)"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="LdLEG`O[Vb{MFFfgzb=w"><field name="VAR" id="3!6Ao_0qLJ@L!=;]ZOq~">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="Guf(_1ydq-?i3|/m:{Hy"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="wL1_u79.o@=2/Xk1Uc?*"><mutation min="0" max="1023" label="Number" precision="0"></mutation><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="*8tI+(*WhP#t0njxW]OL"><value name="micros"><shadow type="math_number_minmax"><mutation min="0" max="6000"></mutation><field name="SLIDER">0</field></shadow><block type="variables_get" id="2#~u`iuUv|IL}|K]~}|["><field name="VAR" id="VIe~3y9PIphdK)v)-g!;">HIGH_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="RVk_G7#/i4`:P5CFy%cH" x="361" y="2297"><mutation name="IRShot" functionid="BTKb=04g;|=[[dbQ=09o"></mutation><field name="function_name">IRShot</field><comment pinned="false" h="80" w="160">Bits are sent starting on msb to lsb</comment><statement name="STACK"><block type="variables_set" id="}b;6Te7:pav1}MXXL-34"><field name="VAR" id="ShaO^DvxrLef5^iO(X90">messageBeingSent</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="DNSJIhV2u|SPnNU$J^{Y"><field name="VAR" id="sv(*sMC.Y6!LP7QQ(|2D">SHOT_MESSAGE</field></block></value><next><block type="variables_set" id=")lB,ivM@V5O-:caq~3.j"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field><comment pinned="false" h="80" w="160">Em binário: 0100 0000 0000 0000
A máscara será usada para transmitir bit a bit</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="{[d9LQVtd*|$2SXc_%g7"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="P2Ff#*6]6ss%u)p9=/00"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="miAy^ds~~ve49hws@F()"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="-)9yz{h^FHl,py_BQ:B{"><field name="VAR" id="_$@f0jr;3yivGg;4#n%/">SHOT_MESSAGE_BIT_SIZE</field></block></value><value name="B"><shadow type="math_number" id="Dtu1tR]_EMFUTTZ#60(t"><field name="NUM">1</field></shadow></value></block></value></block></value><next><block type="function_call" id="xtsxFgUT*kS2yk*0s/D$"><mutation name="transmitBitStartStop" functionid="6|wwB@+-N!Kf4vedT8sL"></mutation><next><block type="device_while" id="uuwHp6Ef-CLTBC~~})j0"><value name="COND"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=")R/GN1/U02+qLEi_eG(o"><field name="OP">GTE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="qdnn%CW/.6{$IZwxTV6Z"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field></block></value><value name="B"><shadow type="math_number" id="keT_s:=ID]MU@;Gs!y+B"><field name="NUM">1</field></shadow></value></block></value><statement name="DO"><block type="variables_set" id="Njp_y]`1y!W_Z[YuOvj}"><field name="VAR" id="xIc6)R2z)LeZrb{C5O#G">temp1</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_op" id="!JH.=X5vJE*Q{U{=42H:"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9{A`I$YMxAiyL#184H+n"><field name="VAR" id="ShaO^DvxrLef5^iO(X90">messageBeingSent</field></block></value><value name="ARG1"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Jy.X1UF.0`3lDAhSKzFk"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field></block></value></block></value><next><block type="controls_if" id="dpP[.EGLaatzz(0kzyo5"><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="3|:PKMyu[~L?L`NA,oTN"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="t`Kn3Jt[/%Cf]mArN?C0"><field name="VAR" id="xIc6)R2z)LeZrb{C5O#G">temp1</field></block></value><value name="B"><shadow type="math_number" id="l.kn=UoU7muSI^@_-8T3"><field name="NUM">1</field></shadow></value></block></value><statement name="DO0"><block type="function_call" id="W5mlF}scojd2x1A0~Ai;"><mutation name="transmitBitHigh" functionid="+D.,.lrT@1,${Y@8bRw,"></mutation></block></statement><statement name="ELSE"><block type="function_call" id="Kj*cVIT2D;@zy+m%K`m]"><mutation name="transmitBitLow" functionid="NOtt@3Uy@)B%v/F~[85_"></mutation></block></statement><next><block type="variables_set" id="[htGNTqzyoNhbk#1mu):"><field name="VAR" id="ShaO^DvxrLef5^iO(X90">messageBeingSent</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="k?JhoAH~OT,5}?2L~LlR"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Ms`?|U%1yoE9-;fifL65"><field name="VAR" id="ShaO^DvxrLef5^iO(X90">messageBeingSent</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="sGua=[Fku%~%ckG2U4XJ"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="quS_K!I}[7U{2]P3wK*~"><field name="VAR" id="xIc6)R2z)LeZrb{C5O#G">temp1</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="kweq;(87H,,TSL#~+tK3"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field></block></value></block></value></block></value><next><block type="variables_set" id="M@]cL_9MAzJK498lhE28"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="/ByD8M:}Xo6Lpa1|xIbT"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="{p*se(J|.(bNv1u}naF!"><field name="VAR" id="2Pt#HhkXH5`/l(p#$jdP">mask</field></block></value><value name="B"><shadow type="math_number" id="zGU^ww!m+[bybJdL5z8I"><field name="NUM">2</field></shadow></value></block></value></block></next></block></next></block></next></block></statement><next><block type="function_call" id="uy^1-sDD`vBH{gRb^^=!"><mutation name="transmitBitStartStop" functionid="6|wwB@+-N!Kf4vedT8sL"></mutation></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="FN6rj{8UQ?v*+pb}):=2" x="1211" y="2297"><mutation name="detectBit" functionid="0d`i`e*,5#FIShwYH!B)"></mutation><field name="function_name">detectBit</field><statement name="STACK"><block type="controls_if" id=".@YB_e@N,/q8X{*RMXYP"><mutation elseif="2"></mutation><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=")e9TwZhaoyX@NQOd(O3K"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="DhEbohe,OO{Itu.nUX1B"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="=9__]$`L|d-xjN2_/gCy"><field name="VAR" id="%!z}6!(SJNAI.ApRvr)6">START_STOP_PAUSE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="x;X3B6Wq_hnniAI7GM/n"><field name="VAR" id="q^S4EwB6_S.}|4RX$R8W">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="^wLme_w(L~B/rq55a@zb"><field name="VAR" id="mkt,?D_Qw2`v4[PrZZry">IRRCV_DETECT_BIT</field></block></value></block></statement><value name="IF1"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id=".@V1!E?Lg39i699Ez86m"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id=",~~+y(51_)$j4#uE!ZHD"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Zh[~+SW,v*t_:gViZb-W"><field name="VAR" id="VIe~3y9PIphdK)v)-g!;">HIGH_PAUSE</field></block></value></block></value><statement name="DO1"><block type="function_call" id="I}EIxL%?zBPg_ng25?l7"><mutation name="pushBitOne" functionid="44{ORh(LabMll`vJ#{GU"></mutation></block></statement><value name="IF2"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="-nT!+(UK~xF8iZlNd#Qe"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="+7~#p-2OgpMp3,8OMJxG"><field name="VAR" id="Zo%]9k={69A.%+gu)6GD">pulseToPulse</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="P#f1y.KU9(O_:e`u_Z6:"><field name="VAR" id="fn}|G=gs7rY([Ptj6BiD">LOW_PAUSE</field></block></value></block></value><statement name="DO2"><block type="function_call" id="gqt:VU#73cmEU,xvF$O)"><mutation name="pushBitZero" functionid="K+Ubqj%jEIe(I,_V.x);"></mutation></block></statement></block></statement></block><block type="function_definition" id="{6?(tX5PUSX:q]DrYf*:" x="1823" y="2297"><mutation name="enableIRDetection" functionid="Dx,b{x^ww+l2^7~e5l[C"></mutation><field name="function_name">enableIRDetection</field><statement name="STACK"><block type="variables_set" id="%9.=Y9}XZ8vz5Z/Hn,lp"><field name="VAR" id="zo;.;0unU95(MqE{IB}v">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number" id="yr]L$?[G+]hS?$Bbw(X!"><field name="NUM">0</field></shadow></value><next><block type="function_call" id="787/W4clgYz2!b[-Szp0"><mutation name="Reset" functionid="-VNEy=_Qy4,HB4flFe-M"></mutation></block></next></block></statement></block><block type="math_arithmetic" id=";:@8/,dfhUJ%}YRVj=Cr" disabled="true" x="2199" y="2297"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="P!r!|zTj5sJHc2Ky-lyp" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="81:(WK@am_7uU4YI=gK5" disabled="true"><field name="NUM">45</field></shadow></value><value name="B"><shadow type="math_number" id="uTtzK+SoQ{M#(NyW-MGQ" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="nn7%@zcGtF9|75V~7%!k" disabled="true"><field name="NUM">1000000</field></shadow></value></block><block type="math_js_op" id="CD-)G+LF]O;A4v#nM3wB" disabled="true" x="2545" y="2297"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_op" id="]kY*IM5b1r[{#e1fOQZ]" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="m;qgWc)lsjTj%;E3C$J`" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="n7e0uMwHFIJVp!4IYc6l" disabled="true"><field name="NUM">6</field></shadow></value><value name="B"><shadow type="math_number" id="0;BIo$1|Frmo9ZKItWAJ" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="-B$*k/_Wk?$xI~gO?U+X" disabled="true"><field name="NUM">38000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="R;z`!}03a?VO_L[3W!Q-" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="math_js_op" id="kIU+3Q-GkKRVh;}Im_o3" disabled="true" x="3193" y="2297"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Q7@S%V^Uf*g_LY?#Vk/4" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="=6?0XU$PG46]]!QXQfVF" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="xiRF4.mbY,O6^6f2u_~u" disabled="true"><field name="NUM">16</field></shadow></value><value name="B"><shadow type="math_number" id="#`r5*t9cm`]5gwoLEI_%" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="JU.L$jX-e4(PoeOv||?A" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="rpxg9luj;97JS2P:@8}O" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="math_js_op" id="W|EXyW1?dB@,4v_th(Qi" disabled="true" x="3744" y="2297"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="{XI#v+XWt2rFxa9y%|p+" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="As;3wu)US=4|u7hlrsMd" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="/|2dYC*tdv;{Q,TYr?P6" disabled="true"><field name="NUM">27</field></shadow></value><value name="B"><shadow type="math_number" id="ffy[6q~X~C-HEQss,Q!i" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="Sl35ZqRSmEGbg$Pc:AdO" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="URtP(%:JAzG|M`EO8p)$" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="variables_get" id="|-Xp$%%7X:n[A,DGW)z5" disabled="true" x="0" y="3308"><field name="VAR" id="-^gcpFKI1e0zI,zy2A~N">messageBeingReceived</field></block></xml>